

{% liquid
  assign product = closest.product
  
  # Check for product tags to determine badge type
  assign show_featured_badge = false
  assign show_ready_to_ship_badge = false
  
  for tag in product.tags
    if tag == 'featured' or tag == 'Featured' or tag == 'FEATURED'
      assign show_featured_badge = true
    elsif tag == 'ready-to-ship' or tag == 'Ready to Ship' or tag == 'READY TO SHIP' or tag == 'ready_to_ship'
      assign show_ready_to_ship_badge = true
    endif
  endfor
  
  # Get product metafields for custom properties
  assign lead_time = product.metafields.custom.lead_time | default: '3 Weeks'
  assign material = product.metafields.custom.material | default: 'Fabric'
  
  # Get variant colors if available
  assign has_color_options = false
  for option in product.options_with_values
    if option.name == 'Color' or option.name == 'Colour'
      assign has_color_options = true
      assign color_option = option
    endif
  endfor
-%}

<style>
  .custom-product-card-wrapper {
    display: flex;
    flex-direction: column;
    border: 1px solid #e5e5e5;
    border-radius: 20px;
    overflow: hidden;
    background: #fff;
    opacity: 1;
    transition: box-shadow 0.3s ease;
    height: auto;
    position: relative;
  }

  .custom-product-card-wrapper:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .custom-product-card-wrapper .product-badge {
    position: absolute;
    top: 16px;
    left: 16px;
    z-index: 10;
    padding: 6px 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 4px;
  }

  .product-badge--featured {
    background-color: #ffffff;
    color: #dc2626;
  }

  .product-badge--ready-to-ship {
    background-color: #ffffff;
    color: #2563eb;
  }

  .custom-product-card-wrapper .product-title {
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #000;
    margin: 16px 16px 8px 16px;
    text-align: center;
    line-height: 1.4;
  }

  .custom-product-card-wrapper .product-price {
    font-size: 16px;
    font-weight: 600;
    color: #6F6F6F;
    margin: 0 16px 12px 16px;
    text-align: center;
  }

  .custom-product-card-wrapper .product-image-container {
    position: relative;
    width: 100%;
    aspect-ratio: 1/1.3;
    overflow: hidden;
    background: #f9f9f9;
  }

  .custom-product-card-wrapper .product-image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-image-dots {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 6px;
    z-index: 5;
  }

  .product-image-dots .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.3);
    transition: background-color 0.3s ease;
  }

  .product-image-dots .dot.active {
    background-color: rgba(0, 0, 0, 0.8);
  }

  .product-info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding: 12px 16px;
    border-top: 1px solid #e5e5e5;
  }

  .product-info-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .product-info-label {
    font-size: 12px;
    color: #6F6F6F;
    text-transform: capitalize;
    margin-bottom: 8px;
    font-weight: 400;
  }

  .product-info-value {
    font-size: 13px;
    color: #000;
    font-weight: 500;
  }

  .product-color-swatches {
    display: flex;
    gap: 6px;
    justify-content: center;
  }

  .color-swatch {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 1px solid #e5e5e5;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .color-swatch:hover {
    transform: scale(1.1);
  }

  .color-swatch.brown {
    background-color: #8b6f47;
  }

  .color-swatch.beige, .color-swatch.tan, .color-swatch.cream {
    background-color: #d4a574;
  }

  .color-swatch.blue, .color-swatch.navy {
    background-color: #2563eb;
  }

  .add-to-project-btn {
    width: calc(100% - 32px);
    margin: 12px 16px 16px 16px;
    padding: 12px 24px;
    background-color: #000;
    color: #fff;
    border: none;
    border-radius: 1px;
    font-size: 13px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .add-to-project-btn:hover {
    background-color: #333;
  }

  @media (max-width: 749px) {
    .product-info-grid {
      grid-template-columns: 1fr;
      gap: 12px;
    }
    
    .custom-product-card-wrapper .product-title {
      font-size: 12px;
    }
    
    .custom-product-card-wrapper .product-price {
      font-size: 14px;
    }
  }
</style>

<div class="custom-product-card-wrapper" {{ block.shopify_attributes }}>
  <!-- Product Badge -->
  {% if show_featured_badge %}
    <div class="product-badge product-badge--featured">
      FEATURED
    </div>
  {% elsif show_ready_to_ship_badge %}
    <div class="product-badge product-badge--ready-to-ship">
      READY TO SHIP
    </div>
  {% endif %}
  
  <!-- Product Title -->
  <div class="product-title">
    {{ product.title }}
  </div>
  
  <!-- Product Price -->
  <div class="product-price">
    {{ product.price | money }}
  </div>
  
  <!-- Product Image Container -->
  <div class="product-image-container">
    <a href="{{ product.url }}">
      {% if product.featured_image %}
        {{
          product.featured_image
          | image_url: width: 800
          | image_tag: loading: 'lazy', alt: product.title
        }}
      {% else %}
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
      {% endif %}
    </a>
    
    <!-- Image Navigation Dots -->
    {% if product.images.size > 1 %}
      <div class="product-image-dots">
        {% for image in product.images limit: 5 %}
          <span class="dot {% if forloop.first %}active{% endif %}"></span>
        {% endfor %}
      </div>
    {% endif %}
  </div>
  
  <!-- Product Info Grid (Lead Time, Color, Material) -->
  <div class="product-info-grid">
    <!-- Lead Time -->
    <div class="product-info-item">
      <div class="product-info-label">Lead Time</div>
      <div class="product-info-value">{{ lead_time }}</div>
    </div>
    
    <!-- Color Swatches -->
    <div class="product-info-item">
      <div class="product-info-label">Color</div>
      <div class="product-info-value">
        {% if has_color_options %}
          <div class="product-color-swatches">
            {% for value in color_option.values limit: 3 %}
              {% assign color_class = value | handleize %}
              <span class="color-swatch {{ color_class }}" title="{{ value }}"></span>
            {% endfor %}
          </div>
        {% else %}
          <div class="product-color-swatches">
            <span class="color-swatch brown" title="Brown"></span>
            <span class="color-swatch beige" title="Beige"></span>
            <span class="color-swatch blue" title="Blue"></span>
          </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Material -->
    <div class="product-info-item">
      <div class="product-info-label">Material</div>
      <div class="product-info-value">{{ material }}</div>
    </div>
  </div>
  
  <!-- Add to Project Button -->
  <button 
    class="add-to-project-btn"
    onclick="window.location.href='{{ product.url }}'"
    type="button"
  >
    ADD TO PROJECT
  </button>
</div>

{% schema %}
{
  "name": "t:names.product_card",
  "blocks": [
    {
      "type": "_product-card-group"
    },
    {
      "type": "text"
    },
    {
      "type": "image"
    },
    {
      "type": "buy-buttons"
    },
    {
      "type": "price"
    },
    {
      "type": "review"
    },
    {
      "type": "sku"
    },
    {
      "type": "swatches"
    },
    {
      "type": "_product-card-gallery"
    },
    {
      "type": "product-title"
    },
    {
      "type": "custom-liquid"
    },
    {
      "type": "@app"
    }
  ],
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "t:content.resource_reference_product_card"
    },
    {
      "type": "range",
      "id": "product_card_gap",
      "label": "t:settings.vertical_gap",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "t:settings.inherit_color_scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "header",
      "content": "t:content.borders"
    },
    {
      "type": "select",
      "id": "border",
      "label": "t:settings.style",
      "options": [
        {
          "value": "none",
          "label": "t:options.none"
        },
        {
          "value": "solid",
          "label": "t:options.solid"
        }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:settings.thickness",
      "default": 1,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "t:settings.opacity",
      "default": 100,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "t:settings.border_radius",
      "min": 0,
      "max": 32,
      "step": 1,
      "default": 0
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ]
}
{% endschema %}
