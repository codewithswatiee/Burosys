{% liquid
  assign heading = section.settings.heading
  assign heading_size = section.settings.heading_size
  assign text_alignment = section.settings.text_alignment
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="section section--{{ section.settings.section_width }} text-with-inline-images color-{{ section.settings.color_scheme }} spacing-style"
  style="
    {%- render 'spacing-style', settings: section.settings -%}
    {% render 'border-override', settings: section.settings %}
    --text-alignment: {{ text_alignment }};
  "
>
  <div class="text-with-inline-images__container">
    {% if heading != blank %}
      <h2 class="text-with-inline-images__heading {{ heading_size }}" style="text-align: {{ text_alignment }};">
        {{ heading }}
      </h2>
    {% endif %}

    <div class="text-with-inline-images__content" style="text-align: {{ text_alignment }};">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'text' %}
            <span class="text-with-inline-images__text {{ block.settings.text_style }}" {{ block.shopify_attributes }}>
              {{ block.settings.text }}
            </span>

          {% when 'image' %}
            {% if block.settings.image != blank %}
              <span class="text-with-inline-images__image-wrapper" {{ block.shopify_attributes }}>
                {{
                  block.settings.image
                  | image_url: width: 150
                  | image_tag: loading: 'lazy', class: 'text-with-inline-images__image', widths: '50, 75, 100, 150, 200, 300'
                }}
              </span>
            {% else %}
              <span class="text-with-inline-images__image-wrapper text-with-inline-images__image-wrapper--placeholder" {{ block.shopify_attributes }}>
                {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
              </span>
            {% endif %}

          {% when 'line_break' %}
            <span class="text-with-inline-images__line-break" {{ block.shopify_attributes }}></span>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

{% stylesheet %}

  .text-with-inline-images__heading {
    margin-bottom: var(--spacing-lg);
    font-weight: 400;
    letter-spacing: 0.05em;
  }

  .text-with-inline-images__heading.h0 {
    font-size: clamp(2rem, 4vw, 3.5rem);
  }

  .text-with-inline-images__heading.h1 {
    font-size: clamp(1.75rem, 3.5vw, 3rem);
  }

  .text-with-inline-images__heading.h2 {
    font-size: clamp(1.5rem, 3vw, 2.5rem);
  }

  .text-with-inline-images__heading.h3 {
    font-size: 20px;
    line-height: 100%;
    letter-spacing: 3px;
    font-weight: 400; }

  .text-with-inline-images__content {
    font-size: 42px;
    line-height: 1.5;
    display: flex;
    flex-wrap: wrap;
    align-items: end;
    justify-content: var(--text-alignment, center);
    margin-top: 20px;
  }

  .text-with-inline-images__text {
    display: inline-block;
    line-height: 1.2;
    letter-spacing: 10px;
  }

  .text-with-inline-images__text.text-uppercase {
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 5px;

  }

  .text-with-inline-images__text.text-bold {
    font-weight: 700;
  }

  .text-with-inline-images__text.text-normal {
    font-weight: 400;
  }

  .text-with-inline-images__image-wrapper {
    display: inline-block;
    line-height: 0;
    height: 70px;
  }

  .text-with-inline-images__image {
    width: 100px;
    height: auto;
    object-fit: contain;
    display: block;
  }



  .text-with-inline-images__image-wrapper--placeholder {
    width: 100px;
    height: 100px;
  }

  .text-with-inline-images__image-wrapper--placeholder svg {
    width: 100%;
    height: 100%;
  }

  .text-with-inline-images__line-break {
    flex-basis: 100%;
    height: 0;
    width: 100%;
  }

  @media screen and (max-width: 749px) {
    .text-with-inline-images__content {
      font-size: 14px;
      gap: 0.4em;
      /* Center inline images vertically with the text on mobile */
      align-items: center;
    }
    .text-with-inline-images__heading.h3{
      font-size: 16px;
    }

    .text-with-inline-images__heading {
      margin-bottom: var(--spacing-md);
    }
    .text-with-inline-images__text,
    .text-with-inline-images__image-wrapper {
      display: inline-block;
      vertical-align: middle;
    }

    .text-with-inline-images__image-wrapper {
      height: auto;
    }

    .text-with-inline-images__image {
      width: 40px;
      height: auto;
    }

    /* Pair text+image into rows on narrow screens */
    .text-with-inline-images__content {
      display: block;
    }

    .text-with-inline-images__row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: auto;
    }

    .text-with-inline-images__row .text-with-inline-images__text {
      flex: 1 1 auto;
      display: block;
      white-space: wrap;
      font-size: 12.5px;
      letter-spacing: 2px;
    }

    .text-with-inline-images__row .text-with-inline-images__image-wrapper {
      flex: 0 0 auto;
    }
  }
{% endstylesheet %}

<script>
  (function(){
    var mq = window.matchMedia('(max-width: 749px)');

    function transformContainer(container){
      var isMobile = mq.matches;

      if (!container.dataset.twiiOriginal) container.dataset.twiiOriginal = container.innerHTML;

      if (!isMobile){
        // restore original markup on larger screens
        container.innerHTML = container.dataset.twiiOriginal;
        return;
      }

      // work from the original markup so multiple resizes are safe
      var temp = document.createElement('div');
      temp.innerHTML = container.dataset.twiiOriginal;
      var nodes = Array.prototype.slice.call(temp.children);

      var rows = [];
      var i = 0;
      while (i < nodes.length){
        var node = nodes[i];

        if (node.classList && node.classList.contains('text-with-inline-images__line-break')){
          i++; // explicit break
          continue;
        }

        if (node.classList && node.classList.contains('text-with-inline-images__text')){
          var textEl = node;
          // only pair with the immediate next node (do NOT pair across explicit line_break)
          var next = nodes[i + 1];
          if (next && next.classList && next.classList.contains('text-with-inline-images__image-wrapper')){
            var row = document.createElement('div');
            row.className = 'text-with-inline-images__row';
            row.appendChild(textEl.cloneNode(true));
            row.appendChild(next.cloneNode(true));
            rows.push(row);
            i = i + 2;
            continue;
          }

          // no image after text — single text row
          var rowT = document.createElement('div');
          rowT.className = 'text-with-inline-images__row';
          rowT.appendChild(textEl.cloneNode(true));
          rows.push(rowT);
          i++;
          continue;
        }

        if (node.classList && node.classList.contains('text-with-inline-images__image-wrapper')){
          // if an image is followed by text, pair image+text preserving order
          var next = nodes[i + 1];
          if (next && next.classList && next.classList.contains('text-with-inline-images__text')){
            var rowIT = document.createElement('div');
            rowIT.className = 'text-with-inline-images__row';
            // preserve original order: image then text
            rowIT.appendChild(node.cloneNode(true));
            rowIT.appendChild(next.cloneNode(true));
            rows.push(rowIT);
            i = i + 2;
            continue;
          }

          // image without adjacent text — make its own row
          var rowI = document.createElement('div');
          rowI.className = 'text-with-inline-images__row';
          rowI.appendChild(node.cloneNode(true));
          rows.push(rowI);
          i++;
          continue;
        }

        // fallback: wrap whatever node we found
        var rowF = document.createElement('div');
        rowF.className = 'text-with-inline-images__row';
        rowF.appendChild(node.cloneNode(true));
        rows.push(rowF);
        i++;
      }

      // replace container content with rows
      container.innerHTML = '';
      rows.forEach(function(r){ container.appendChild(r); });
    }

    function init(){
      var containers = document.querySelectorAll('.text-with-inline-images__content');
      containers.forEach(function(c){ transformContainer(c); });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    var resizeTimer;
    window.addEventListener('resize', function(){
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(init, 150);
    });
  })();
</script>

{% schema %}
{
  "name": "Text with Inline Images",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "WHY FROM US?"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading Size",
      "options": [
        {
          "value": "h0",
          "label": "Extra Large"
        },
        {
          "value": "h1",
          "label": "Large"
        },
        {
          "value": "h2",
          "label": "Medium"
        },
        {
          "value": "h3",
          "label": "Small"
        }
      ],
      "default": "h3"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        {
          "value": "page-width",
          "label": "Page Width"
        },
        {
          "value": "full-width",
          "label": "Full Width"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "YOUR TEXT HERE"
        },
        {
          "type": "select",
          "id": "text_style",
          "label": "Text Style",
          "options": [
            {
              "value": "text-normal",
              "label": "Normal"
            },
            {
              "value": "text-bold",
              "label": "Bold"
            },
            {
              "value": "text-uppercase",
              "label": "Uppercase & Bold"
            }
          ],
          "default": "text-uppercase"
        }
      ]
    },
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    },
    {
      "type": "line_break",
      "name": "Line Break"
    }
  ],
  "presets": [
    {
      "name": "Text with Inline Images",
      "blocks": [
        {
          "type": "text",
          "settings": {
            "text": "THOUGHTFULLY DESIGNED",
            "text_style": "text-uppercase"
          }
        },
        {
          "type": "image"
        },
        {
          "type": "text",
          "settings": {
            "text": "FURNITURE",
            "text_style": "text-uppercase"
          }
        },
        {
          "type": "line_break"
        },
        {
          "type": "image"
        },
        {
          "type": "text",
          "settings": {
            "text": "MADE TO UPLIFT YOUR HOME AND OFFICE EVERY SINGLE DAY",
            "text_style": "text-normal"
          }
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
