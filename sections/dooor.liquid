{{ 'section-dooor.css' | asset_url | stylesheet_tag }}

<div class="dooor-section color-{{ section.settings.color_scheme }} gradient">
  <div class="dooor-container page-width">
    {% if section.settings.subtitle != blank %}
      <p class="dooor-subtitle">{{ section.settings.subtitle }}</p>
    {% endif %}
    
    {% if section.settings.title != blank %}
      <h2 class="dooor-title {{ section.settings.heading_size }}">{{ section.settings.title }}</h2>
    {% endif %}

    {%- if section.blocks.size > 0 -%}
      <div class="dooor-filters">
        <button class="dooor-filter-btn active" data-filter="all">All</button>
        {%- for block in section.blocks -%}
          {%- if block.type == 'category' -%}
            <button class="dooor-filter-btn" data-filter="{{ block.settings.category_id }}">
              {{ block.settings.category_name }}
            </button>
          {%- endif -%}
        {%- endfor -%}
      </div>

      <div class="dooor-gallery">
        {%- for block in section.blocks -%}
          {%- if block.type == 'image_item' -%}
            <div class="dooor-gallery-item" data-categories="{{ block.settings.categories }}" {{ block.shopify_attributes }}>
              {%- if block.settings.image != blank -%}
                <div class="dooor-image-wrapper">
                  {%- if block.settings.link != blank -%}
                    <a href="{{ block.settings.link }}" class="dooor-image-link">
                  {%- endif -%}
                  
                  <img
                    srcset="
                      {%- if block.settings.image.width >= 375 -%}{{ block.settings.image | image_url: width: 375 }} 375w,{%- endif -%}
                      {%- if block.settings.image.width >= 550 -%}{{ block.settings.image | image_url: width: 550 }} 550w,{%- endif -%}
                      {%- if block.settings.image.width >= 750 -%}{{ block.settings.image | image_url: width: 750 }} 750w,{%- endif -%}
                      {%- if block.settings.image.width >= 1100 -%}{{ block.settings.image | image_url: width: 1100 }} 1100w,{%- endif -%}
                      {{ block.settings.image | image_url }} {{ block.settings.image.width }}w
                    "
                    src="{{ block.settings.image | image_url: width: 550 }}"
                    sizes="(min-width: 1200px) calc((100vw - 10rem) / 3), (min-width: 750px) calc((100vw - 10rem) / 2), calc(100vw - 3rem)"
                    alt="{{ block.settings.image.alt | escape }}"
                    loading="lazy"
                    width="{{ block.settings.image.width }}"
                    height="{{ block.settings.image.height }}"
                  >
                  
                  {%- if block.settings.link != blank -%}
                    </a>
                  {%- endif -%}
                </div>
              {%- endif -%}
              
              {%- if block.settings.caption != blank -%}
                <p class="dooor-caption">{{ block.settings.caption }}</p>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dooorSection = document.querySelector('.dooor-section');
    if (!dooorSection) return;

    const filterButtons = dooorSection.querySelectorAll('.dooor-filter-btn');
    const galleryItems = dooorSection.querySelectorAll('.dooor-gallery-item');

    // Initialize all items as visible immediately
    galleryItems.forEach(item => {
      item.classList.add('visible');
      item.style.display = 'block';
    });

    // Add click event to filter buttons
    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        const filter = button.dataset.filter;
        
        // Update active button
        filterButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        // Filter items
        galleryItems.forEach(item => {
          if (filter === 'all') {
            item.classList.remove('visible');
            setTimeout(() => {
              item.style.display = 'block';
              setTimeout(() => item.classList.add('visible'), 10);
            }, 10);
          } else {
            const categories = item.dataset.categories ? item.dataset.categories.split(',').map(c => c.trim()) : [];
            if (categories.includes(filter)) {
              item.classList.remove('visible');
              setTimeout(() => {
                item.style.display = 'block';
                setTimeout(() => item.classList.add('visible'), 10);
              }, 10);
            } else {
              item.classList.remove('visible');
              setTimeout(() => item.style.display = 'none', 300);
            }
          }
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Dooor Gallery",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "LOREM IPSUM"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "WHERE TO USE DOOOR"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "Small"
        },
        {
          "value": "h1",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        }
      ],
      "default": "h1",
      "label": "Heading size"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "options": [
        {
          "value": "accent-1",
          "label": "Accent 1"
        },
        {
          "value": "accent-2",
          "label": "Accent 2"
        },
        {
          "value": "background-1",
          "label": "Background 1"
        },
        {
          "value": "background-2",
          "label": "Background 2"
        },
        {
          "value": "inverse",
          "label": "Inverse"
        }
      ],
      "default": "background-1",
      "label": "Color scheme"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Filter Category",
      "settings": [
        {
          "type": "text",
          "id": "category_name",
          "label": "Category Name",
          "info": "e.g., Residential, Workspace, Hospitality"
        },
        {
          "type": "text",
          "id": "category_id",
          "label": "Category ID",
          "info": "Unique identifier (lowercase, no spaces). e.g., residential, workspace"
        }
      ]
    },
    {
      "type": "image_item",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Caption",
          "info": "e.g., Showroom in Sicily"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "categories",
          "label": "Categories",
          "info": "Comma-separated category IDs. e.g., residential,workspace"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Dooor Gallery",
      "blocks": [
        {
          "type": "category",
          "settings": {
            "category_name": "Residential",
            "category_id": "residential"
          }
        },
        {
          "type": "category",
          "settings": {
            "category_name": "Workspace",
            "category_id": "workspace"
          }
        },
        {
          "type": "category",
          "settings": {
            "category_name": "Hospitality",
            "category_id": "hospitality"
          }
        },
        {
          "type": "category",
          "settings": {
            "category_name": "Retail",
            "category_id": "retail"
          }
        },
        {
          "type": "category",
          "settings": {
            "category_name": "Education",
            "category_id": "education"
          }
        },
        {
          "type": "category",
          "settings": {
            "category_name": "Healthcare",
            "category_id": "healthcare"
          }
        },
        {
          "type": "category",
          "settings": {
            "category_name": "Exhibition",
            "category_id": "exhibition"
          }
        },
        {
          "type": "image_item"
        },
        {
          "type": "image_item"
        },
        {
          "type": "image_item"
        }
      ]
    }
  ]
}
{% endschema %}